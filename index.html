<html>
  <head>
    <title>Eats chutes and ladders</title>
    <style>
      #gameboard {
        width: 600px;
        display: flex;
        flex-wrap: wrap;
      }
      .row {
        display: flex;
        flex-direction: row;
      }
      .reverse {
        display: flex;
        flex-direction: row-reverse;
      }
      .square {
        padding: 1em;
        width: 1em;
        height: 1em;
        background-color: lightcyan;
        border: 1px solid grey;
        text-align: center;
      }
    </style>
    <script>
      let counts = {};
      function runSim() {
        //returns a list of all squares stepped on.
        const jumpSquares = {
          1: 38,
          4: 14,
          9: 31,
          16: 6,
          21: 42,
          28: 84,
          36: 44,
          47: 26,
          49: 11,
          51: 67,
          56: 53,
          62: 19,
          64: 60,
          71: 91,
          80: 100,
          87: 24,
          93: 73,
          95: 75,
          98: 78,
        };
        const spinWheel = () => {
          return Math.ceil(Math.random() * 6);
        };

        let currentSquare = 0;
        let squaresVisited = [];
        while (currentSquare != 100) {
          let spacesToMove = spinWheel();
          let newSquare = currentSquare + spacesToMove;
          if (newSquare > 100) {
            currentSquare = currentSquare;
          } else if (jumpSquares[newSquare]) {
            squaresVisited.push(newSquare);
            currentSquare = jumpSquares[newSquare];
          } else {
            currentSquare = newSquare;
          }
          squaresVisited.push(currentSquare);
        }

        return squaresVisited;
      }

      function simStats(numberOfRuns) {
        for (let i = 0; i < numberOfRuns; i++) {
          let results = runSim();
          for (let j = 0; j < results.length; j++) {
            let num = results[j];
            counts[num] = counts[num] ? counts[num] + 1 : 1;
            const shade = 255 - Math.floor(counts[num] / 255);
            document.getElementById(
              `square_${num}`
            ).style.backgroundColor = `rgb(${shade},${shade},${shade})`;
            document
              .getElementById(`square_${num}`)
              .setAttribute("title", `${counts[num]}`);
          }
        }
        return counts;
      }

      function showGame() {
        buildBoard();
        const game = runSim();
        const localCounts = {};
        let step = 0;
        console.log("game", game);
        let interval = setInterval(() => {
          if (!game[step]) {
            clearInterval(interval);
          } else {
            const currentSquare = game[step];
            localCounts[currentSquare] = localCounts[currentSquare]
              ? localCounts[currentSquare] + 1
              : 1;

            let elem = document.getElementById(`square_${currentSquare}`);
            elem.style.backgroundColor = "green";
            elem.style.border = `1px solid green`;
            setTimeout(() => {
              const shade = 255 - (35 + localCounts[currentSquare] * 35);
              elem.style.backgroundColor = `rgb(${shade},${shade},${shade}`;
              elem.style.border = `1px solid grey`;
            }, 50);
            step += 1;
          }
        }, 100);
      }

      function buildBoard() {
        const gameboard = document.getElementById("gameboard");
        gameboard.innerHTML = "";

        for (let rows = 0; rows < 10; rows++) {
          const row = document.createElement("div");
          row.classList.add("row");
          if (rows % 2 == 1) {
            row.classList.add("reverse");
          }
          for (let squares = 0; squares < 10; squares++) {
            const squareNumber = 101 - (rows * 10 + (squares + 1));
            const square = document.createElement("div");
            square.classList.add("square");
            square.id = `square_${squareNumber}`;
            square.innerHTML = squareNumber;
            row.appendChild(square);
          }
          gameboard.appendChild(row);
        }
      }
      const clearStats = () => {
        counts = {};
        buildBoard();
      };
    </script>
  </head>
  <body onload="buildBoard()">
    <button onclick="simStats(10000)">Run 10,000 Games</button>
    <button onclick="showGame()">Run 1 Game</button>
    <button onclick="clearStats()">Clear Stats</button>
    <div id="gameboard"></div>
  </body>
</html>
